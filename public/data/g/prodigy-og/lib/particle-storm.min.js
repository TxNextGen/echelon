Phaser.ParticleStorm=function(t,e){Phaser.Plugin.call(this,t,e),this.emitters=[],this.dataList={};var r=PIXI.canUseNewCanvasBlendModes();this.blendModeMap={NORMAL:[0,"source-over"],ADD:[1,"lighter"],MULTIPLY:[2,r?"multiply":"source-over"],SCREEN:[3,r?"screen":"source-over"],OVERLAY:[4,r?"overlay":"source-over"],DARKEN:[5,r?"darken":"source-over"],LIGHTEN:[6,r?"lighten":"source-over"],COLOR_DODGE:[7,r?"color-dodge":"source-over"],COLOR_BURN:[8,r?"color-burn":"source-over"],HARD_LIGHT:[9,r?"hard-light":"source-over"],SOFT_LIGHT:[10,r?"soft-light":"source-over"],DIFFERENCE:[11,r?"difference":"source-over"],EXCLUSION:[12,r?"exclusion":"source-over"],HUE:[13,r?"hue":"source-over"],SATURATION:[14,r?"saturation":"source-over"],COLOR:[15,r?"color":"source-over"],LUMINOSITY:[16,r?"luminosity":"source-over"]},this.hsv=Phaser.Color.HSVColorWheel()},Phaser.ParticleStorm.prototype=Object.create(Phaser.Plugin.prototype),Phaser.ParticleStorm.prototype.constructor=Phaser.ParticleStorm,Phaser.ParticleStorm.SPRITE="sprite",Phaser.ParticleStorm.PIXEL="pixel",Phaser.ParticleStorm.RENDERTEXTURE="render texture",Phaser.ParticleStorm.SPRITE_BATCH="sprite batch",Phaser.ParticleStorm.BITMAP_DATA="bitmap data",Phaser.ParticleStorm.BASE={value:0,initial:0,delta:0,offset:0,control:null,calc:0},Phaser.ParticleStorm.BASE_1={value:1,initial:0,delta:0,offset:0,control:null,calc:1},Phaser.ParticleStorm.BASE_255={value:0,initial:0,delta:0,offset:0,min:0,max:255,control:null,calc:0},Phaser.ParticleStorm.BASE_359={value:0,initial:0,delta:0,offset:0,min:0,max:359,control:null,calc:0},Phaser.ParticleStorm.BASE_NULL={value:null,initial:0,delta:0,offset:0,control:null,calc:0},Phaser.ParticleStorm.BASE_EMIT={name:null,value:0,initial:0,control:null,at:null,inherit:!0,offsetX:0,offsetY:0},Phaser.ParticleStorm.Controls={},Phaser.ParticleStorm.Zones={},Phaser.ParticleStorm.prototype.createEmitter=function(t,e,r){var i=new Phaser.ParticleStorm.Emitter(this,t,e,r);return this.emitters.push(i),i},Phaser.ParticleStorm.prototype.removeEmitter=function(t){for(var e=0;e<this.emitters.length;e++)if(this.emitters[e]===t)return void this.emitters.splice(e,1)},Phaser.ParticleStorm.prototype.addData=function(t,e){if(void 0===t)return this;if(Array.isArray(t))for(var r=0;r<t.length;r++)this.dataList[t[r]]=this.game.cache.getJSON(t[r]);else void 0!==e?this.dataList[t]=e:this.dataList[t]=this.game.cache.getJSON(t);return this},Phaser.ParticleStorm.prototype.getData=function(t){return this.dataList[t]},Phaser.ParticleStorm.prototype.clearData=function(t){if(void 0===t)this.dataList={};else if(Array.isArray(t))for(var e=0;e<t.length;e++)delete this.dataList[t[e]];else delete this.dataList[t];return this},Phaser.ParticleStorm.prototype.cloneData=function(t,e){if(void 0===t)return this;if(Array.isArray(t))for(var r=0;r<t.length;r++)this.dataList[t[r]]=Phaser.Utils.extend(!0,this.game.cache.getJSON(t[r]));else void 0!==e?this.dataList[t]=Phaser.Utils.extend(!0,e):this.dataList[t]=Phaser.Utils.extend(!0,this.game.cache.getJSON(t));return this},Phaser.ParticleStorm.prototype.createPointZone=function(t,e){return new Phaser.ParticleStorm.Zones.Point(this.game,t,e)},Phaser.ParticleStorm.prototype.createLineZone=function(t,e,r,i){return new Phaser.ParticleStorm.Zones.Line(this.game,t,e,r,i)},Phaser.ParticleStorm.prototype.createRectangleZone=function(t,e){return new Phaser.ParticleStorm.Zones.Rectangle(this.game,t,e)},Phaser.ParticleStorm.prototype.createCircleZone=function(t){return new Phaser.ParticleStorm.Zones.Circle(this.game,t)},Phaser.ParticleStorm.prototype.createEllipseZone=function(t,e){return new Phaser.ParticleStorm.Zones.Ellipse(this.game,t,e)},Phaser.ParticleStorm.prototype.createLinearSplineZone=function(t,e,r){return new Phaser.ParticleStorm.Zones.Spline(this.game,0,t,e,r)},Phaser.ParticleStorm.prototype.createBezierSplineZone=function(t,e,r){return new Phaser.ParticleStorm.Zones.Spline(this.game,1,t,e,r)},Phaser.ParticleStorm.prototype.createCatmullSplineZone=function(t,e,r){return new Phaser.ParticleStorm.Zones.Spline(this.game,2,t,e,r)},Phaser.ParticleStorm.prototype.createSplineZone=function(t,e,r,i){return new Phaser.ParticleStorm.Zones.Spline(this.game,t,e,r,i)},Phaser.ParticleStorm.prototype.createTextZone=function(t){return new Phaser.ParticleStorm.Zones.Text(this.game,t)},Phaser.ParticleStorm.prototype.createImageZone=function(t){return new Phaser.ParticleStorm.Zones.Image(this.game,t)},Phaser.ParticleStorm.prototype.update=function(){if(this.active)for(var t=0;t<this.emitters.length;t++)this.emitters[t].manualUpdate||this.emitters[t].update()},Phaser.ParticleStorm.Emitter=function(t,e,r,i){this.game=t.game,this.parent=t,this.renderer=null,this.renderType=null,this.graph=Phaser.ParticleStorm.Graph,this.enabled=!1,this.manualUpdate=!1,this.scrollSpeed=new Phaser.Point,this.force=new Phaser.Point,this.onEmit=null,this.onComplete=null,this.onKill=null,this.particleClass=Phaser.ParticleStorm.Particle,this.timer=this.game.time.create(!1),this.timerEvent=null,this.list=[],this.pool=[],this.batch=[],this.wells=[],this._rnd=new Phaser.Point,this._step=new Phaser.Point,this._pCount=0,this._delay={enabled:!1,start:0,inc:0,visible:!1},this.init(e,r,i)},Phaser.ParticleStorm.Emitter.prototype={init:function(t,e,r){void 0===t&&(t=Phaser.ParticleStorm.SPRITE);var i=this.game.width,a=this.game.height;switch(t){case Phaser.ParticleStorm.SPRITE:this.renderer=new Phaser.ParticleStorm.Renderer.Sprite(this);break;case Phaser.ParticleStorm.PIXEL:this.renderer=new Phaser.ParticleStorm.Renderer.Pixel(this,i,a);break;case Phaser.ParticleStorm.RENDERTEXTURE:this.renderer=new Phaser.ParticleStorm.Renderer.RenderTexture(this,i,a);break;case Phaser.ParticleStorm.SPRITE_BATCH:this.renderer=new Phaser.ParticleStorm.Renderer.SpriteBatch(this);break;case Phaser.ParticleStorm.BITMAP_DATA:this.renderer=new Phaser.ParticleStorm.Renderer.BitmapData(this,i,a);break;default:return console.warn("ParticleManager.init - Invalid renderType given"),!1}this.renderType=t,e&&this.force.set(e.x,e.y),r&&this.scrollSpeed.set(r.x,r.y),this.list=[],this.pool=[],this.wells=[],this.enabled=!0},addToWorld:function(t){return void 0===t&&(t=this.game.world),this.renderer.addToWorld(t)},createGravityWell:function(t,e,r,i,a){var s=new Phaser.ParticleStorm.GravityWell(this,t,e,r,i,a);return this.wells.push(s),s},seed:function(t){for(var e=0;t>e;e++){var r=new Phaser.ParticleStorm.Particle(this);this.pool.push(r)}return this},emitDelayed:function(t,e,r,i,a){return!this.enabled||!this.parent.dataList[e]||0>=t?null:(this.timerEvent=this.timer.add(t,this.emit,this,e,r,i,a),this.timer.start(),this.timerEvent)},emit:function(t,e,r,i){if(!this.enabled||!this.parent.dataList[t])return null;if(this.batch=[],this._pCount=0,this._step.x=0,this._step.y=0,void 0===e&&(e=0),void 0===r&&(r=0),!i)return this.emitParticle(t,e,r,null);var a=i.hasOwnProperty("total")?i.total:1;if(i.xStep>0?this._step.x=i.xStep:this._step.x=0,i.yStep>0?this._step.y=i.yStep:this._step.y=0,this._delay.enabled=!1,i.delay&&(this._delay.enabled=!0,"number"==typeof i.delay?(this._delay.start=i.delay,this._delay.step=0,this._delay.visible=!1):(this._delay.start=i.delay.start?i.delay.start:0,this._delay.step=i.delay.step?i.delay.step:0,this._delay.visible=i.delay.visible?!0:!1)),i.zone)if(void 0===i.random&&void 0===i.full&&void 0===i.percent||i.random)i.zone.emit(this,t,e,r,a,i.setAlpha,i.setColor);else if(void 0!==i.percent||void 0===i.full&&i.random){if(void 0!==i.percent){var s=0;"number"==typeof i.percent?s=i.percent:i.percent.hasOwnProperty("min")?s=this.game.rnd.between(i.percent.min,i.percent.max):i.percent.callback&&(s=i.percent.callback.call(i.percent.context,this)),i.zone.emitPercent(this,t,e,r,a,s)}}else i.zone.emitFull(this,t,e,r,i.step,i.spacing,i.setAlpha,i.setColor);else for(var o=0;a>o;o++)this.emitParticle(t,e,r,null);if(i.radiate)for(var l=0;l<this.batch.length;l++)this.batch[l].radiate(i.radiate.velocity,i.radiate.from,i.radiate.to);else if(i.radiateFrom)for(var l=0;l<this.batch.length;l++)this.batch[l].radiateFrom(i.radiateFrom.x,i.radiateFrom.y,i.radiateFrom.velocity);var h=i.hasOwnProperty("repeat")?i.repeat:0;if(0!==h){var n=i.hasOwnProperty("frequency")?i.frequency:250;delete i.repeat,-1===h?this.timerEvent=this.timer.loop(n,this.emit,this,t,e,r,i):h>0&&(this.timerEvent=this.timer.repeat(n,h,this.emit,this,t,e,r,i)),this.timer.start()}return this._pCount=0,this.batch},emitParticle:function(t,e,r,i){var a=this.pool.pop();return a||(a=new this.particleClass(this)),a.parent=i,Array.isArray(e)&&(e=this.game.rnd.between(e[0],e[1])),Array.isArray(r)&&(r=this.game.rnd.between(r[0],r[1])),e+=this._step.x*this._pCount,r+=this._step.y*this._pCount,a.reset(this.renderer,e,r,this.parent.dataList[t]),a.alive?(!i&&this._delay.enabled&&(a.delay+=this._delay.start+this._pCount*this._delay.step,a.delayVisible=this._delay.visible),this.list.push(a),this.batch.push(a),i||this._pCount++):(a.kill(),this.onKill&&this.onKill.dispatch(this,a),this.pool.push(a)),a},update:function(){var t=this.game.time.elapsed;this.renderer.preUpdate();for(var e=this.list.length-1;e>=0;e--){var r=this.list[e];r.ignoreScrollSpeed||(r.transform.x+=this.scrollSpeed.x,r.transform.y+=this.scrollSpeed.y);for(var i=0;i<this.wells.length;i++)this.wells[i].active&&this.wells[i].step(r);r.step(t,this.force)||(r.kill(),this.pool.push(r),this.list.splice(e,1))}return this.renderer.postUpdate(),this.list.length},updateFrequency:function(t,e,r,i){if(t.at){for(var a=0,s=0;s<t.at.length;s++){var o=t.at[s];(o.time>r||0===o.time&&0===r)&&o.time<=i&&(o.value>0&&o.value<1?Math.random()<o.value&&(a+=1):a+=o.value)}return a}return this.graph.getParamArea(t,r,i)*e},forEach:function(t,e){if(arguments.length<=2)for(var r=0;r<this.list.length;r++)t.call(e,this.list[r]);else{for(var i=[null],r=2;r<arguments.length;r++)i.push(arguments[r]);for(var r=0;r<this.list.length;r++)i[0]=this.list[r],t.apply(e,i)}},forEachNew:function(t,e){if(0!==this.batch.length)if(arguments.length<=2)for(var r=0;r<this.batch.length;r++)t.call(e,this.batch[r]);else{for(var i=[null],r=2;r<arguments.length;r++)i.push(arguments[r]);for(var r=0;r<this.batch.length;r++)i[0]=this.batch[r],t.apply(e,i)}},getParticle:function(t){return void 0===t&&(t=0),this.list[t]?this.list[t]:null},debug:function(t,e){var r=this.game.debug;if(r){r.start(t+4,e+16,"rgb(255, 255, 255)",132),r.context.fillStyle="rgba(0, 74, 128, 0.5)",r.context.fillRect(t,e,360,70);var i=this.force.x+"",a=this.force.y+"";r.line("Force:",i.substr(0,8),a.substr(0,8)),r.line("Scroll Speed:",this.scrollSpeed.x,this.scrollSpeed.y),r.line("Alive:","Dead:","Total:"),r.line(this.alive,this.dead,this.total),r.stop()}},destroy:function(){this.renderer.clear&&this.renderer.clear(),this.renderer.destroy(),this.renderer=null;for(var t=this.list.length-1;t>=0;t--)this.list[t].kill(),this.list.splice(t,1);this.list=[],this.pool=[],this.batch=[],this.wells=[]}},Object.defineProperty(Phaser.ParticleStorm.Emitter.prototype,"paused",{get:function(){return!this.enabled},set:function(t){this.enabled=!t}}),Object.defineProperty(Phaser.ParticleStorm.Emitter.prototype,"total",{get:function(){return this.alive+this.dead}}),Object.defineProperty(Phaser.ParticleStorm.Emitter.prototype,"alive",{get:function(){return this.list.length}}),Object.defineProperty(Phaser.ParticleStorm.Emitter.prototype,"dead",{get:function(){return this.pool.length}}),Phaser.ParticleStorm.Emitter.prototype.constructor=Phaser.ParticleStorm.Emitter,Phaser.ParticleStorm.Particle=function(t){this.emitter=t,this.renderer=null,this.graph=Phaser.ParticleStorm.Graph,this.transform=new Phaser.ParticleStorm.Controls.Transform(this),this.color=new Phaser.ParticleStorm.Controls.Color(this),this.texture=new Phaser.ParticleStorm.Controls.Texture(this),this.parent=null,this.lifespan=2e3,this.keepAlive=!1,this.delay=0,this.delayVisible=!1,this.life=0,this.sprite=null,this.visible=!1,this.isComplete=!1,this.ignoreForce=!1,this.ignoreScrollSpeed=!1,this.emit={},this._age=0,this._lastPercent=0,this._numToEmit=0},Phaser.ParticleStorm.Particle.prototype={reset:function(t,e,r,i){return this.renderer=t,this.transform.reset(),this.color.reset(),this.texture.reset(),this.emit=Object.create(Phaser.ParticleStorm.BASE_EMIT),this.isComplete=!1,this.keepAlive=!1,this.delay=0,this.delayVisible=!1,this.ignoreForce=!1,this.ignoreScrollSpeed=!1,this.alive=!1,this.lifespan=2e3,this.life=0,this.visible=!1,this._age=0,this._lastPercent=0,this._numToEmit=0,void 0!==i&&this.create(e,r,i),this},create:function(t,e,r){if(r.hasOwnProperty("lifespan")&&(this.lifespan=this.graph.getMinMax(r.lifespan)),this.keepAlive=r.keepAlive,r.hasOwnProperty("delay")&&(this.delay=this.graph.getMinMax(r.delay)),this.ignoreForce=r.ignoreForce,this.ignoreScrollSpeed=r.ignoreScrollSpeed,this.transform.init(t,e,r),this.color.init(r),this.texture.init(r),r.emit&&(this.emit=Object.create(r.emit)),this.visible=r.visible===!1?!1:!0,this.alive=!0,this.parent&&this.parent.emit&&this.parent.emit.inherit&&(this.alive=this.onInherit(this.parent)),this.alive){this.transform.step(),this.color.step();var i=this.renderer.add(this);i&&this.texture.step(r,i),this.onEmit(),this.emitter.onEmit&&this.emitter.onEmit.dispatch(this.emitter,this),this.renderer.update(this)}return this},step:function(t,e){if(this._age+=t,this.delay){if(this._age<this.delay)return this.renderer.update(this),!0;this.delay=0,this._age=0}if(this._lastPercent=this.life,this.lifespan>0&&(this.life=Math.min(this._age/this.lifespan,1)),e&&!this.ignoreForce&&(this.transform.velocity.x.value+=e.x,this.transform.velocity.y.value+=e.y),this.transform.step(),this.color.step(),this.onUpdate(),this.alive){for(this._numToEmit+=this.emitter.updateFrequency(this.emit,t,this._lastPercent,this.life);this._numToEmit>=1;)this.emitChild();this.renderer.update(this)}return this.isComplete||1!==this.life||(this.isComplete=!0,this.emitter.onComplete&&this.emitter.onComplete.dispatch(this.emitter,this)),this.life<1||this.keepAlive},emitChild:function(){var t=0|this.graph.getMinMax(this.emit.offsetX),e=0|this.graph.getMinMax(this.emit.offsetY);if(this.emit.rect){var r=this.emit.rect;t=Math.random()*r.width+r.x,e=Math.random()*r.height+r.y}else if(this.emit.circle){var i=this.emit.circle;e=Math.random()*i*2-i;var a=Math.sqrt(i*i-e*e);t=Math.random()*a*2-a}var s=this.emit.name;if("string"!=typeof s&&(s=this.getChildKey(this.emit.name)),s){var o=this.emitter.emitParticle(s,this.transform.x+t,this.transform.y+e,this);o&&this.emit.overwrite&&this.applyOverwrite(this.emit.overwrite,o)}this._numToEmit-=1},applyOverwrite:function(t,e){return e},getChildKey:function(t){if(Array.isArray(t))return this.emitter.game.rnd.pick(t);if(void 0!==t.at&&t.at.length>0){for(var e=t.at[0].value,r=0;r<t.at.length&&!(t.at[r].time>this.life);r++)e=t.at[r].value;return e}return null},radiate:function(t,e,r){void 0===r&&void 0!==e?r=e:(void 0===e&&(e=0),void 0===r&&(r=359));var i=t;t.hasOwnProperty("min")?i=this.graph.getMinMax(t):Array.isArray(t)&&(i=parseFloat(this.emitter.game.rnd.pick(t),10));var a=(Math.random()*(r-e)+e)*Math.PI/180;return this.transform.velocity.x.value=Math.sin(a)*i,this.transform.velocity.y.value=-Math.cos(a)*i,this},radiateFrom:function(t,e,r){var i=r;r.hasOwnProperty("min")?i=this.graph.getMinMax(r):Array.isArray(r)&&(i=parseFloat(this.emitter.game.rnd.pick(r),10));var a=this.transform.x-t,s=this.transform.y-e,o=Math.sqrt(a*a+s*s);return this.transform.velocity.x.value=a*i/o,this.transform.velocity.y.value=s*i/o,this},target:function(t){var e=0,r=0,i=this.transform;if(t.x&&(e=t.x),t.y&&(r=t.y),t.zone){var a=t.zone.getRandom();e+=a.x,r+=a.y}var s=Math.atan2(r-i.y,e-i.x),o=i.x-e,l=i.y-r,h=Math.sqrt(o*o+l*l)/(this.lifespan/1e3),n=Math.cos(s)*h*i.time.physicsElapsed,c=Math.sin(s)*h*i.time.physicsElapsed;return t.speed?(this.graph.fromControl({value:2*n,control:t.speed},i.velocity.x),this.graph.fromControl({value:2*c,control:t.speed},i.velocity.y)):(i.velocity.x.value=n,i.velocity.y.value=c),this},setLife:function(t,e){return this.lifespan=this.graph.getMinMax(t),this.life=0,this._age=0,this._lastPercent=0,this.isComplete=!1,this.keepAlive=e,this},kill:function(){this.alive=!1,this.renderer.kill(this),this.onKill()},onEmit:function(){},onUpdate:function(){},onInherit:function(){return!0},onKill:function(){}},Object.defineProperty(Phaser.ParticleStorm.Particle.prototype,"lifePercent",{get:function(){return Math.round(100*this.life)}}),Object.defineProperty(Phaser.ParticleStorm.Particle.prototype,"frequency",{get:function(){return this.emit.value},set:function(t){this.emit.value=t}}),Phaser.ParticleStorm.Particle.prototype.constructor=Phaser.ParticleStorm.Particle,Phaser.ParticleStorm.GravityWell=function(t,e,r,i,a,s){void 0===e&&(e=0),void 0===r&&(r=0),void 0===i&&(i=0),void 0===a&&(a=100),void 0===s&&(s=50),this.emitter=t,this.time=t.game.time,this.position=new Phaser.Point(e,r),this.active=!0,this._gravity=s,this._power=0,this._epsilon=0,this.power=i,this.epsilon=a},Phaser.ParticleStorm.GravityWell.prototype={step:function(t){var e=this.position.x-t.transform.x,r=this.position.y-t.transform.y,i=e*e+r*r;if(0!==i){var a=Math.sqrt(i);i<this._epsilon&&(i=this._epsilon);var s=this._power*this.time.elapsed/(i*a);t.transform.velocity.x.value+=e*s,t.transform.velocity.y.value+=r*s}}},Object.defineProperty(Phaser.ParticleStorm.GravityWell.prototype,"epsilon",{get:function(){return Math.sqrt(this._epsilon)},set:function(t){this._epsilon=t*t}}),Object.defineProperty(Phaser.ParticleStorm.GravityWell.prototype,"power",{get:function(){return this._power/this.gravity},set:function(t){this._power=t*this.gravity}}),Object.defineProperty(Phaser.ParticleStorm.GravityWell.prototype,"gravity",{get:function(){return this._gravity},set:function(t){var e=this.power;this._gravity=t,this.power=e}}),Phaser.ParticleStorm.GravityWell.prototype.constructor=Phaser.ParticleStorm.GravityWell,Phaser.ParticleStorm.Graph={CONTROL_LINEAR:[{x:0,y:1},{x:1,y:0}],CONTROL_REVERSE:[{x:0,y:0},{x:1,y:1}],CONTROL_YOYO:[{x:0,y:0},{x:.5,y:1},{x:1,y:0}],getControlValue:function(t,e){var r=0,i=t[r];if(i.x===e)return i.y;for(;i.x<=e;){if(r>=t.length-1)return i.x;i=t[++r]}var a=t[r-1];return a.y+(e-a.x)*(i.y-a.y)/(i.x-a.x)},getControlValues:function(t,e,r){var i=Phaser.ParticleStorm.Graph.getControlValue(t,e),a=[{x:e,y:i}];if(e>=r)return a;for(var s=0;s<t.length;s++)if(t[s].x>e){if(!(t[s].x<r))break;a.push(t[s])}return a.push({x:r,y:Phaser.ParticleStorm.Graph.getControlValue(t,r)}),a},getParamArea:function(t,e,r){return t.control?t.value*Phaser.ParticleStorm.Graph.getControlArea(t.control,e,r):t.value},getControlArea:function(t,e,r){var i=Phaser.ParticleStorm.Graph.getControlValues(t,e,r);if(e>=r)return i[0].y;for(var a=i.length>1?0:i.y,s=i[0],o=1;o<i.length;o++){var l=i[o];a+=.5*(l.x-s.x)*(s.y+l.y),s=l}return a},getMinMaxInitial:function(t){return void 0!==t.initial?Phaser.ParticleStorm.Graph.getMinMax(t.initial):0},isNumeric:function(t){return!isNaN(parseFloat(t))&&isFinite(t)},getMinMax:function(t){return void 0!==t&&null!==t&&void 0!==t.min&&void 0!==t.max?t.min+Math.random()*(t.max-t.min):t},clone:function(t,e){return e.value=t.value,e.initial=t.initial,e.delta=t.delta,e.offset=t.offset,e.min=t.min,e.max=t.max,e.control=t.control,e},fromControl:function(t,e){void 0!==t.value&&(e.value=Phaser.ParticleStorm.Graph.getMinMax(t.value)),t.control&&("linear"===t.control?e.control=Phaser.ParticleStorm.Graph.CONTROL_LINEAR:"reverse"===t.control?e.control=Phaser.ParticleStorm.Graph.CONTROL_REVERSE:"yoyo"===t.control?e.control=Phaser.ParticleStorm.Graph.CONTROL_YOYO:e.control=t.control)},fromData:function(t,e){return void 0===t||null===t?!1:"number"==typeof t?(e.value=t,!0):(void 0!==t.min?e.value=Phaser.ParticleStorm.Graph.getMinMax(t):void 0!==t.value&&(e.value=Phaser.ParticleStorm.Graph.getMinMax(t.value)),void 0!==t.initial&&(e.initial=Phaser.ParticleStorm.Graph.getMinMax(t.initial)),void 0!==t.delta&&(e.delta=Phaser.ParticleStorm.Graph.getMinMax(t.delta)),void 0!==t.offset&&(e.offset=Phaser.ParticleStorm.Graph.getMinMax(t.offset)),t.control&&("linear"===t.control?e.control=Phaser.ParticleStorm.Graph.CONTROL_LINEAR:"reverse"===t.control?e.control=Phaser.ParticleStorm.Graph.CONTROL_REVERSE:"yoyo"===t.control?e.control=Phaser.ParticleStorm.Graph.CONTROL_YOYO:e.control=t.control),!0)},getValue:function(t,e){if(!t.control||void 0===e)return t.value;var r=t.control[0];if(r.x===e)return r.y;var i=t.control.length-1,a=t.control[i];if(a.x===e)return a.y;for(i=0;r.x<=e;){if(i>=t.control.length-1)return r.y;r=t.control[++i]}var s=t.control[i-1];return t.value*(s.y+(e-s.x)*(r.y-s.y)/(r.x-s.x))},getClampedValue:function(t,e){return Phaser.Math.clamp(Math.floor(t.initial+this.getValue(t,e)),t.min,t.max)}},Phaser.ParticleStorm.Zones={},Phaser.ParticleStorm.Zones.Base=function(t){this.game=t,this.active=!0,this.scale=new Phaser.Point(1,1),this.alphaThreshold=0,this._rnd=new Phaser.Point},Phaser.ParticleStorm.Zones.Base.prototype={getRandom:function(){return this.shape===Phaser.Point?this._rnd=this.shape:this.shape.random(this._rnd),this._rnd.x*=this.scale.x,this._rnd.y*=this.scale.y,this._rnd},emit:function(t,e,r,i,a){Array.isArray(r)&&(r=this.game.rnd.between(r[0],r[1])),Array.isArray(i)&&(i=this.game.rnd.between(i[0],i[1]));for(var s=null,o=0;a>o;o++)this.shape.random(this._rnd),s=t.emitParticle(e,r+this._rnd.x*this.scale.x,i+this._rnd.y*this.scale.y,null);return s}},Phaser.ParticleStorm.Zones.Base.prototype.constructor=Phaser.ParticleStorm.Zones.Base,Phaser.ParticleStorm.Zones.Point=function(t,e,r){Phaser.ParticleStorm.Zones.Base.call(this,t),this.shape=new Phaser.Point(e,r)},Phaser.ParticleStorm.Zones.Point.prototype=Object.create(Phaser.ParticleStorm.Zones.Base.prototype),Phaser.ParticleStorm.Zones.Point.prototype.constructor=Phaser.ParticleStorm.Zones.Point,Phaser.ParticleStorm.Zones.Rectangle=function(t,e,r){Phaser.ParticleStorm.Zones.Base.call(this,t),this.shape=new Phaser.Rectangle(0,0,e,r)},Phaser.ParticleStorm.Zones.Rectangle.prototype=Object.create(Phaser.ParticleStorm.Zones.Base.prototype),Phaser.ParticleStorm.Zones.Rectangle.prototype.constructor=Phaser.ParticleStorm.Zones.Rectangle,Phaser.ParticleStorm.Zones.Circle=function(t,e){Phaser.ParticleStorm.Zones.Base.call(this,t),this.shape=new Phaser.Circle(0,0,2*e)},Phaser.ParticleStorm.Zones.Circle.prototype=Object.create(Phaser.ParticleStorm.Zones.Base.prototype),Phaser.ParticleStorm.Zones.Circle.prototype.constructor=Phaser.ParticleStorm.Zones.Circle,Phaser.ParticleStorm.Zones.Ellipse=function(t,e,r){Phaser.ParticleStorm.Zones.Base.call(this,t),this.shape=new Phaser.Ellipse(0,0,e,r)},Phaser.ParticleStorm.Zones.Ellipse.prototype=Object.create(Phaser.ParticleStorm.Zones.Base.prototype),Phaser.ParticleStorm.Zones.Ellipse.prototype.constructor=Phaser.ParticleStorm.Zones.Ellipse,Phaser.ParticleStorm.Zones.Line=function(t,e,r,i,a){Phaser.ParticleStorm.Zones.Base.call(this,t),this.shape=new Phaser.Line(e,r,i,a)},Phaser.ParticleStorm.Zones.Line.prototype=Object.create(Phaser.ParticleStorm.Zones.Base.prototype),Phaser.ParticleStorm.Zones.Line.prototype.constructor=Phaser.ParticleStorm.Zones.Line,Phaser.ParticleStorm.Zones.Spline=function(t,e,r,i,a){void 0===e&&(e=0),void 0===r&&(r=1e3),void 0===i&&(i=!0),Phaser.ParticleStorm.Zones.Base.call(this,t),this.math=this.game.math,this.points={x:[],y:[]},this.path=[],this.resolution=r,this.mode=e,this.closed=i,this.mult=0,this.update(a)},Phaser.ParticleStorm.Zones.Spline.prototype=Object.create(Phaser.ParticleStorm.Zones.Base.prototype),Phaser.ParticleStorm.Zones.Spline.prototype.constructor=Phaser.ParticleStorm.Zones.Spline,Phaser.ParticleStorm.Zones.Spline.prototype.update=function(t){this.points={x:[],y:[]},this.path=[];for(var e=0;e<t.length;e++)this.points.x.push(t[e].x),this.points.y.push(t[e].y);this.closed&&(this.points.x.push(t[0].x),this.points.y.push(t[0].y));for(var r=0,i=1/this.resolution,e=0;1>=e;e+=i){if(0===this.mode)var a=this.math.linearInterpolation(this.points.x,e),s=this.math.linearInterpolation(this.points.y,e);else if(1===this.mode)var a=this.math.bezierInterpolation(this.points.x,e),s=this.math.bezierInterpolation(this.points.y,e);else if(2===this.mode)var a=this.math.catmullRomInterpolation(this.points.x,e),s=this.math.catmullRomInterpolation(this.points.y,e);var o={x:a,y:s,angle:0};r>0&&(o.angle=this.math.angleBetweenPoints(this.path[r-1],o)),this.path.push(o),r++}return this.mult=this.path.length/100,this},Phaser.ParticleStorm.Zones.Spline.prototype.getRandom=function(){return this.game.rnd.pick(this.path)},Phaser.ParticleStorm.Zones.Spline.prototype.emit=function(t,e,r,i,a){Array.isArray(r)&&(r=this.game.rnd.between(r[0],r[1])),Array.isArray(i)&&(i=this.game.rnd.between(i[0],i[1]));for(var s=null,o=null,l=0;a>l;l++)s=this.game.rnd.pick(this.path),o=t.emitParticle(e,r+s.x,i+s.y);return o},Phaser.ParticleStorm.Zones.Spline.prototype.emitPercent=function(t,e,r,i,a,s){Array.isArray(r)&&(r=this.game.rnd.between(r[0],r[1])),Array.isArray(i)&&(i=this.game.rnd.between(i[0],i[1]));var o=null;s=Math.floor(s*this.mult);for(var l=0;a>l;l++){var h=this.path[s];h&&(o=t.emitParticle(e,r+h.x,i+h.y))}return o},Phaser.ParticleStorm.Zones.Text=function(t,e){Phaser.ParticleStorm.Zones.Base.call(this,t),this.bmd=new Phaser.BitmapData(t,"ParticleStorm.Text"),this.text=e,this.points=[],this.update(e)},Phaser.ParticleStorm.Zones.Text.prototype=Object.create(Phaser.ParticleStorm.Zones.Base.prototype),Phaser.ParticleStorm.Zones.Text.prototype.constructor=Phaser.ParticleStorm.Zones.Text,Phaser.ParticleStorm.Zones.Text.prototype.update=function(t){void 0!==t?this.text=t:t=this.text;var e=t.x,r=t.y,i=t.scale.x,a=t.scale.y;return t.x=0,t.y=0,t.scale.set(1),this.points=[],this.bmd.load(t),this.bmd.processPixelRGB(this.addPixel,this),this.scale=new Phaser.Point(i,a),t.x=e,t.y=r,t.scale.set(i,a),this},Phaser.ParticleStorm.Zones.Text.prototype.addPixel=function(t,e,r){return t.a>this.alphaThreshold&&this.points.push({x:e,y:r,color:{r:t.r,g:t.g,b:t.b,a:t.a/255}}),!1},Phaser.ParticleStorm.Zones.Text.prototype.getRandom=function(){var t=this.game.rnd.pick(this.points);return t.x*=this.scale.x,t.y*=this.scale.y,t},Phaser.ParticleStorm.Zones.Text.prototype.emit=function(t,e,r,i,a,s,o){Array.isArray(r)&&(r=this.game.rnd.between(r[0],r[1])),Array.isArray(i)&&(i=this.game.rnd.between(i[0],i[1]));for(var l=null,h=null,n=0;a>n;n++)l=this.game.rnd.pick(this.points),h=t.emitParticle(e,r+l.x*this.scale.x,i+l.y*this.scale.y),h&&(s&&l.color.a<1&&(h.color.alpha.value=l.color.a),o&&h.color.setColor(l.color.r,l.color.g,l.color.b,l.color.a));return h},Phaser.ParticleStorm.Zones.Text.prototype.emitFull=function(t,e,r,i,a,s,o,l){void 0===a&&(a=1);var h=1,n=1;Array.isArray(s)?(h=s[0],n=s[1]):"number"==typeof s&&(h=s,n=s),Array.isArray(r)&&(r=this.game.rnd.between(r[0],r[1])),Array.isArray(i)&&(i=this.game.rnd.between(i[0],i[1]));for(var c=null,p=null,m=0;m<this.points.length;m+=a){c=this.points[m];var u=r+c.x*this.scale.x*(h/a),P=i+c.y*this.scale.y*(n/a);p=t.emitParticle(e,u,P),p&&(o&&c.color.a<1&&(p.color.alpha.value=c.color.a),l&&p.color.setColor(c.color.r,c.color.g,c.color.b,c.color.a))}return p},Phaser.ParticleStorm.Zones.Image=function(t,e){Phaser.ParticleStorm.Zones.Base.call(this,t),this.bmd=new Phaser.BitmapData(t,"ParticleStorm.Image"),this.key=e,this.points=[],this.update(e)},Phaser.ParticleStorm.Zones.Image.prototype=Object.create(Phaser.ParticleStorm.Zones.Base.prototype),Phaser.ParticleStorm.Zones.Image.prototype.constructor=Phaser.ParticleStorm.Zones.Image,Phaser.ParticleStorm.Zones.Image.prototype.update=function(t){return void 0===t&&(t=this.key),this.points=[],this.bmd.load(t),this.bmd.processPixelRGB(this.addPixel,this),this},Phaser.ParticleStorm.Zones.Image.prototype.addPixel=function(t,e,r){return t.a>this.alphaThreshold&&this.points.push({x:e,y:r,color:{r:t.r,g:t.g,b:t.b,a:t.a/255}}),!1},Phaser.ParticleStorm.Zones.Image.prototype.getRandom=function(){var t=this.game.rnd.pick(this.points);return t.x*=this.scale.x,t.y*=this.scale.y,t},Phaser.ParticleStorm.Zones.Image.prototype.emit=function(t,e,r,i,a,s,o){Array.isArray(r)&&(r=this.game.rnd.between(r[0],r[1])),Array.isArray(i)&&(i=this.game.rnd.between(i[0],i[1]));for(var l=null,h=null,n=0;a>n;n++)l=this.game.rnd.pick(this.points),h=t.emitParticle(e,r+l.x*this.scale.x,i+l.y*this.scale.y),h&&(s&&l.color.a<1&&(h.color.alpha.value=l.color.a),o&&h.color.setColor(l.color.r,l.color.g,l.color.b,l.color.a));return h},Phaser.ParticleStorm.Zones.Image.prototype.emitFull=function(t,e,r,i,a,s,o,l){void 0===a&&(a=1);var h=1,n=1;Array.isArray(s)?(h=s[0],n=s[1]):"number"==typeof s&&(h=s,n=s),Array.isArray(r)&&(r=this.game.rnd.between(r[0],r[1])),Array.isArray(i)&&(i=this.game.rnd.between(i[0],i[1]));for(var c=null,p=null,m=0;m<this.points.length;m+=a){c=this.points[m];var u=r+c.x*this.scale.x*(h/a),P=i+c.y*this.scale.y*(n/a);p=t.emitParticle(e,u,P),p&&(o&&c.color.a<1&&(p.color.alpha.value=c.color.a),l&&p.color.setColor(c.color.r,c.color.g,c.color.b,c.color.a))}return p},Phaser.ParticleStorm.Controls.Texture=function(t){this.particle=t,this.rnd=t.emitter.game.rnd,this.graph=Phaser.ParticleStorm.Graph,this.sendToBack=!1,this.bringToTop=!0,this.key=null,this.frame=void 0,this.frameName=void 0,this.scaleMode=Phaser.scaleModes.DEFAULT},Phaser.ParticleStorm.Controls.Texture.prototype={reset:function(){this.sendToBack=!1,this.bringToTop=!0,this.key="__default",this.frame=void 0,this.frameName=void 0,this.scaleMode=Phaser.scaleModes.DEFAULT},init:function(t){if(t.sendToBack?this.sendToBack=t.sendToBack:t.bringToTop&&(this.bringToTop=t.bringToTop),t.image&&(Array.isArray(t.image)?this.key=this.rnd.pick(t.image):this.key=t.image),void 0!==t.frame){var e=t.frame;Array.isArray(t.frame)&&(e=this.rnd.pick(t.frame)),this.graph.isNumeric(e)?this.frame=e:this.frameName=e}if(t.scaleMode){var r=t.scaleMode.toUpperCase();"LINEAR"===r?this.scaleMode=Phaser.scaleModes.LINEAR:"NEAREST"===r&&(this.scaleMode=Phaser.scaleModes.NEAREST)}},step:function(t,e){if(this.particle.emitter.renderType===Phaser.ParticleStorm.SPRITE&&void 0!==t.animations){var r=[];for(var i in t.animations){var a=t.animations[i],s=null,o=!0;void 0!==a.frames&&(s=Array.isArray(a.frames)?a.frames:Phaser.Animation.generateFrameNames(a.frames.prefix,a.frames.start,a.frames.stop,a.frames.suffix,a.frames.zeroPad),"string"==typeof s[0]&&(o=!1));var l=void 0===a.frameRate?60:a.frameRate,h=void 0===a.loop?!1:a.loop;e.animations.add(i,s,l,h,o),r.push(i)}r.length>0&&(void 0!==t.play?e.play(this.rnd.pick(r)):e.play(r[0]))}this.sendToBack?e.sendToBack():this.bringToTop&&e.bringToTop()}},Phaser.ParticleStorm.Controls.Texture.prototype.constructor=Phaser.ParticleStorm.Controls.Texture,Phaser.ParticleStorm.Controls.Color=function(t){this.particle=t,this.graph=Phaser.ParticleStorm.Graph,this.red={},this.green={},this.blue={},this.alpha={},this.hsv={},this.hsvData=this.particle.emitter.parent.hsv,this.tint=0,this.isTinted=!1,this.rgba="rgba(0, 0, 0, 1)",this.blendMode=this.particle.emitter.parent.blendModeMap.NORMAL},Phaser.ParticleStorm.Controls.Color.prototype={reset:function(){this.red=Object.create(Phaser.ParticleStorm.BASE_255),this.green=Object.create(Phaser.ParticleStorm.BASE_255),this.blue=Object.create(Phaser.ParticleStorm.BASE_255),this.alpha=Object.create(Phaser.ParticleStorm.BASE_1),this.tint=16777215,this.isTinted=!1,this.isHSV=!1,this.hsv=Object.create(Phaser.ParticleStorm.BASE_359),this.rgba="rgba(0, 0, 0, 1)",this.blendMode=this.particle.emitter.parent.blendModeMap.NORMAL},init:function(t){var e=!1;t.hasOwnProperty("hsv")?("number"==typeof t.hsv?this.hsv.value=t.hsv:this.graph.fromData(t.hsv,this.hsv),e=!0,this.isHSV=!0):(t.hasOwnProperty("red")&&("number"==typeof t.red?this.red.value=t.red:this.graph.fromData(t.red,this.red),e=!0),t.hasOwnProperty("green")&&("number"==typeof t.green?this.green.value=t.green:this.graph.fromData(t.green,this.green),e=!0),t.hasOwnProperty("blue")&&("number"==typeof t.blue?this.blue.value=t.blue:this.graph.fromData(t.blue,this.blue),e=!0)),t.hasOwnProperty("alpha")&&("number"==typeof t.alpha?this.alpha.value=t.alpha:this.graph.fromData(t.alpha,this.alpha)),
    this.red.value=Phaser.Math.clamp(this.red.value,0,255),this.green.value=Phaser.Math.clamp(this.green.value,0,255),this.blue.value=Phaser.Math.clamp(this.blue.value,0,255),this.alpha.value=Phaser.Math.clamp(this.alpha.value,0,1),this.hsv.value=Phaser.Math.clamp(this.hsv.value,0,359),this.particle.emitter.renderType!==Phaser.ParticleStorm.PIXEL&&(this.isTinted=e),t.blendMode&&(this.blendMode=this.particle.emitter.parent.blendModeMap[t.blendMode.toUpperCase()])},step:function(){var t=this.particle.life;this.isHSV?(this.hsv.value+=this.hsv.delta,this.hsv.calc=Phaser.Math.clamp(Math.floor(this.hsv.initial+this.graph.getValue(this.hsv,t)),0,359),this.red.value=this.hsvData[this.hsv.calc].r,this.green.value=this.hsvData[this.hsv.calc].g,this.blue.value=this.hsvData[this.hsv.calc].b):(this.red.value+=this.red.delta,this.green.value+=this.green.delta,this.blue.value+=this.blue.delta),this.red.calc=this.graph.getClampedValue(this.red,t),this.green.calc=this.graph.getClampedValue(this.green,t),this.blue.calc=this.graph.getClampedValue(this.blue,t),this.isTinted&&(this.tint=this.red.calc<<16|this.green.calc<<8|this.blue.calc),this.alpha.value+=this.alpha.delta,this.alpha.calc=Phaser.Math.clamp(this.alpha.initial+this.graph.getValue(this.alpha,t),0,1),this.rgba="rgba("+this.red.calc+","+this.green.calc+","+this.blue.calc+","+this.alpha.calc+")"},setColor:function(t,e,r,i){this.red.value=t,this.green.value=e,this.blue.value=r,this.alpha.value=i,this.particle.emitter.renderType!==Phaser.ParticleStorm.PIXEL&&(this.isTinted=!0),this.step()}},Phaser.ParticleStorm.Controls.Color.prototype.constructor=Phaser.ParticleStorm.Controls.Color,Phaser.ParticleStorm.Controls.Transform=function(t){this.particle=t,this.time=t.emitter.game.time,this.graph=Phaser.ParticleStorm.Graph,this.x=0,this.y=0,this.velocity={x:null,y:null,facing:null},this.acceleration={x:null,y:null,facing:null},this.scale={x:null,y:null},this.rotation={},this.anchor=new Phaser.Point},Phaser.ParticleStorm.Controls.Transform.prototype={reset:function(){this.velocity.x=Object.create(Phaser.ParticleStorm.BASE),this.velocity.y=Object.create(Phaser.ParticleStorm.BASE),this.velocity.facing=Object.create(Phaser.ParticleStorm.BASE_NULL),this.acceleration.x=Object.create(Phaser.ParticleStorm.BASE),this.acceleration.y=Object.create(Phaser.ParticleStorm.BASE),this.acceleration.facing=Object.create(Phaser.ParticleStorm.BASE_NULL),this.scale.x=Object.create(Phaser.ParticleStorm.BASE_1),this.scale.y=Object.create(Phaser.ParticleStorm.BASE_1),this.rotation=Object.create(Phaser.ParticleStorm.BASE),this.anchor.set(.5)},init:function(t,e,r){if(this.x=t,this.y=e,r.hasOwnProperty("anchor")?this.anchor.set(r.anchor):(r.hasOwnProperty("anchorX")&&(this.anchor.x=r.anchorX),r.hasOwnProperty("anchorY")&&(this.anchor.y=r.anchorY)),r.hasOwnProperty("velocity")){if(this.graph.isNumeric(r.velocity))this.velocity.x.value=r.velocity,this.velocity.y.value=r.velocity;else if(r.velocity.hasOwnProperty("min"))this.velocity.x.value=this.graph.getMinMax(r.velocity),this.velocity.y.value=this.velocity.x.value;else if(r.velocity.radial){var i=this.graph.getMinMaxInitial(r.velocity),a=r.velocity.radial.arcStart,s=r.velocity.radial.arcEnd;if(void 0!==a&&void 0!==s){var o=(Math.random()*(s-a)+a)*Math.PI/180,l=Math.sin(o),h=-Math.cos(o);this.velocity.x.value=l*i,this.velocity.y.value=h*i}}else this.velocity.x.initial=this.graph.getMinMaxInitial(r.velocity),this.velocity.y.initial=this.velocity.x.initial,this.velocity.x.value=this.graph.getMinMax(r.velocity.value),this.velocity.y.value=this.velocity.x.value;r.velocity.hasOwnProperty("delta")&&(this.velocity.x.delta=this.graph.getMinMax(r.velocity.delta),this.velocity.y.delta=this.velocity.x.delta),r.velocity.hasOwnProperty("control")&&(this.velocity.x.control=r.velocity.control,this.velocity.y.control=r.velocity.control),r.hasOwnProperty("vx")&&this.graph.fromData(r.vx,this.velocity.x),r.hasOwnProperty("vy")&&this.graph.fromData(r.vy,this.velocity.y)}else r.hasOwnProperty("target")?this.particle.target(r.target):("number"==typeof r.vx?this.velocity.x.value=r.vx:this.graph.fromData(r.vx,this.velocity.x),"number"==typeof r.vy?this.velocity.y.value=r.vy:this.graph.fromData(r.vy,this.velocity.y));"number"==typeof r.facingVelocity?this.velocity.facing.value=r.facingVelocity:this.graph.fromData(r.facingVelocity,this.velocity.facing),"number"==typeof r.facingAcceleration?this.acceleration.facing.value=r.facingAcceleration:this.graph.fromData(r.facingAcceleration,this.acceleration.facing),r.hasOwnProperty("acceleration")?(this.graph.fromData(r.acceleration,this.acceleration.x),this.graph.fromData(r.acceleration,this.acceleration.y)):("number"==typeof r.ax?this.acceleration.x.value=r.ax:this.graph.fromData(r.ax,this.acceleration.x),"number"==typeof r.ay?this.acceleration.y.value=r.ay:this.graph.fromData(r.ay,this.acceleration.y)),r.hasOwnProperty("scale")?(this.graph.fromData(r.scale,this.scale.x),this.graph.clone(this.scale.x,this.scale.y)):("number"==typeof r.scaleX?this.scale.x.value=r.scaleX:this.graph.fromData(r.scaleX,this.scale.x),"number"==typeof r.scaleY?this.scale.y.value=r.scaleY:this.graph.fromData(r.scaleY,this.scale.y)),"number"==typeof r.rotation?this.rotation.value=r.rotation:this.graph.fromData(r.rotation,this.rotation);var n=this.particle.parent;n&&n.emit&&n.emit.inherit&&this.inherit(n)},inherit:function(t){var e=t.emit.inherit,r=!1;if("boolean"==typeof e&&(r=!0),(r||e.vx||e.velocity)&&this.graph.clone(t.transform.velocity.x,this.velocity.x),(r||e.vy||e.velocity)&&this.graph.clone(t.transform.velocity.y,this.velocity.y),(r||e.facingVelocity)&&this.graph.clone(t.transform.velocity.facing,this.velocity.facing),(r||e.scaleX||e.scale)&&this.graph.clone(t.transform.scale.x,this.scale.x),(r||e.scaleY||e.scale)&&this.graph.clone(t.transform.scale.y,this.scale.y),(r||e.rotation)&&this.graph.clone(t.transform.rotation,this.rotation),e.angularVelocity){var i=(t.transform.rotation.initial+t.transform.rotation.value)*Math.PI/180;this.velocity.x.initial=Math.sin(i),this.velocity.y.initial=-Math.cos(i)}},step:function(){var t=this.particle.life;if(this.scale.x.value+=this.scale.x.delta,this.scale.y.value+=this.scale.y.delta,this.rotation.value+=this.rotation.delta,this.rotation.calc=(this.rotation.initial+this.graph.getValue(this.rotation,t))*Math.PI/180,this.scale.x.calc=this.scale.x.initial+this.graph.getValue(this.scale.x,t),this.scale.y.calc=this.scale.y.initial+this.graph.getValue(this.scale.y,t),0!==t){var e=0,r=0;null!==this.acceleration.facing.value&&(this.acceleration.facing.value+=this.acceleration.facing.delta,e=this.rotation.calc+(90+this.acceleration.facing.offset)*Math.PI/180,r=this.acceleration.facing.initial+this.graph.getValue(this.acceleration.facing,t),this.velocity.x.value+=r*Math.sin(e),this.velocity.y.value+=r*-Math.cos(e)),this.acceleration.x.value+=this.acceleration.x.delta,this.acceleration.y.value+=this.acceleration.y.delta,this.velocity.x.value+=this.velocity.x.delta+this.acceleration.x.initial+this.graph.getValue(this.acceleration.x,t),this.velocity.y.value+=this.velocity.y.delta+this.acceleration.y.initial+this.graph.getValue(this.acceleration.y,t),null!==this.velocity.facing.value&&(this.velocity.facing.value+=this.velocity.facing.delta,e=this.rotation.calc+(90+this.velocity.facing.offset)*Math.PI/180,r=this.velocity.facing.initial+this.graph.getValue(this.velocity.facing,t),this.x+=r*Math.sin(e),this.y+=r*-Math.cos(e)),this.x+=this.velocity.x.initial+this.graph.getValue(this.velocity.x,t),this.y+=this.velocity.y.initial+this.graph.getValue(this.velocity.y,t)}}},Phaser.ParticleStorm.Controls.Transform.prototype.constructor=Phaser.ParticleStorm.Controls.Transform,Phaser.ParticleStorm.Renderer={},Phaser.ParticleStorm.Renderer.Base=function(t){this.game=t.game,this.emitter=t,this.parent=t.parent,this.pixelSize=1},Phaser.ParticleStorm.Renderer.Base.prototype={addToWorld:function(t){return t.add(this.display),this.display},preUpdate:function(){},add:function(){return null},update:function(t){return t},postUpdate:function(){},kill:function(t){return t},destroy:function(){this.game=null}},Phaser.ParticleStorm.Renderer.Base.prototype.constructor=Phaser.ParticleStorm.Renderer.Base,Phaser.ParticleStorm.Renderer.Sprite=function(t){Phaser.ParticleStorm.Renderer.Base.call(this,t),this.display=this.game.make.group(null,"particleStormSpriteRenderer")},Phaser.ParticleStorm.Renderer.Sprite.prototype=Object.create(Phaser.ParticleStorm.Renderer.Base.prototype),Phaser.ParticleStorm.Renderer.Sprite.prototype.constructor=Phaser.ParticleStorm.Renderer.Sprite,Phaser.ParticleStorm.Renderer.Sprite.prototype.add=function(t){var e=t.sprite,r=t.texture.key,i=t.texture.frame;return void 0===i&&void 0!==t.texture.frameName&&(i=t.texture.frameName),e?(e.reset(t.transform.x,t.transform.y),e.key!==r?e.loadTexture(r,i):void 0!==t.texture.frame?e.frame=i:void 0!==t.texture.frameName&&(e.frameName=i)):e=this.display.create(t.transform.x,t.transform.y,r,i),e.anchor.set(t.transform.anchor.x,t.transform.anchor.y),t.color.isTinted&&(e.tint=t.color.tint),e.blendMode=t.color.blendMode[0],e.texture.baseTexture.scaleMode=t.texture.scaleMode,e.visible=t.visible,t.sprite=e,e},Phaser.ParticleStorm.Renderer.Sprite.prototype.update=function(t){var e=t.sprite;return t.delay>0&&!t.delayVisible?void(e.visible=!1):(e.visible=t.visible,e.alpha=t.color.alpha.calc,e.rotation=t.transform.rotation.calc,t.color.isTinted&&(e.tint=t.color.tint),e.scale.setTo(t.transform.scale.x.calc,t.transform.scale.y.calc),e.x=t.transform.x,void(e.y=t.transform.y))},Phaser.ParticleStorm.Renderer.Sprite.prototype.kill=function(t){t.sprite&&t.sprite.kill()},Phaser.ParticleStorm.Renderer.Sprite.prototype.destroy=function(){this.display.destroy(!0),this.emitter=null,this.game=null},Phaser.ParticleStorm.Renderer.Pixel=function(t,e,r){Phaser.ParticleStorm.Renderer.Base.call(this,t),this.bmd=this.game.make.bitmapData(e,r),this.display=this.game.make.image(0,0,this.bmd),this.autoClear=!0},Phaser.ParticleStorm.Renderer.Pixel.prototype=Object.create(Phaser.ParticleStorm.Renderer.Base.prototype),Phaser.ParticleStorm.Renderer.Pixel.prototype.constructor=Phaser.ParticleStorm.Renderer.Pixel,Phaser.ParticleStorm.Renderer.Pixel.prototype.resize=function(t,e){return this.bmd.resize(t,e),this},Phaser.ParticleStorm.Renderer.Pixel.prototype.clear=function(t){return this.bmd.fill(0,0,0,t),this.bmd.update(),this},Phaser.ParticleStorm.Renderer.Pixel.prototype.preUpdate=function(){this.autoClear&&(this.bmd.clear(),this.bmd.update())},Phaser.ParticleStorm.Renderer.Pixel.prototype.update=function(t){if(!(t.delay>0)||t.delayVisible){var e=Math.floor(t.transform.x),r=Math.floor(t.transform.y),i=t.color.red.calc,a=t.color.green.calc,s=t.color.blue.calc,o=Math.floor(255*t.color.alpha.calc);this.pixelSize>2?this.bmd.rect(e,r,this.pixelSize,this.pixelSize,t.color.rgba):(this.bmd.setPixel32(e,r,i,a,s,o,!1),2===this.pixelSize&&(this.bmd.setPixel32(e+1,r,i,a,s,o,!1),this.bmd.setPixel32(e,r+1,i,a,s,o,!1),this.bmd.setPixel32(e+1,r+1,i,a,s,o,!1)))}},Phaser.ParticleStorm.Renderer.Pixel.prototype.postUpdate=function(){this.pixelSize<=2&&this.bmd.context.putImageData(this.bmd.imageData,0,0),this.bmd.dirty=!0},Phaser.ParticleStorm.Renderer.Pixel.prototype.destroy=function(){this.game=null,this.display.destroy(),this.bmd.destroy()},Phaser.ParticleStorm.Renderer.BitmapData=function(t,e,r){Phaser.ParticleStorm.Renderer.Base.call(this,t),this.bmd=this.game.make.bitmapData(e,r),this.display=this.game.make.image(0,0,this.bmd),this.roundPx=!0,this.autoClear=!0},Phaser.ParticleStorm.Renderer.BitmapData.prototype=Object.create(Phaser.ParticleStorm.Renderer.Base.prototype),Phaser.ParticleStorm.Renderer.BitmapData.prototype.constructor=Phaser.ParticleStorm.Renderer.BitmapData,Phaser.ParticleStorm.Renderer.BitmapData.prototype.resize=function(t,e){return this.bmd.resize(t,e),this},Phaser.ParticleStorm.Renderer.BitmapData.prototype.clear=function(t){return this.bmd.fill(0,0,0,t),this},Phaser.ParticleStorm.Renderer.BitmapData.prototype.preUpdate=function(){this.autoClear&&this.bmd.clear()},Phaser.ParticleStorm.Renderer.BitmapData.prototype.update=function(t){if(!(t.delay>0)||t.delayVisible){var e=t.transform;this.bmd.copy(t.texture.key,0,0,null,null,e.x,e.y,null,null,e.rotation.calc,e.anchor.x,e.anchor.y,e.scale.x.calc,e.scale.y.calc,t.color.alpha.calc,t.color.blendMode[1],this.roundPx)}},Phaser.ParticleStorm.Renderer.BitmapData.prototype.destroy=function(){this.game=null,this.display.destroy(),this.bmd.destroy()},Phaser.ParticleStorm.Renderer.RenderTexture=function(t,e,r){Phaser.ParticleStorm.Renderer.Base.call(this,t),this.renderTexture=this.game.make.renderTexture(e,r),this.display=this.game.make.image(0,0,this.renderTexture),this.stamp=this.game.make.image(0,0),this.autoClear=!0},Phaser.ParticleStorm.Renderer.RenderTexture.prototype=Object.create(Phaser.ParticleStorm.Renderer.Base.prototype),Phaser.ParticleStorm.Renderer.RenderTexture.prototype.constructor=Phaser.ParticleStorm.Renderer.RenderTexture,Phaser.ParticleStorm.Renderer.RenderTexture.prototype.clear=function(){this.renderTexture.clear()},Phaser.ParticleStorm.Renderer.RenderTexture.prototype.preUpdate=function(){this.autoClear&&this.renderTexture.clear()},Phaser.ParticleStorm.Renderer.RenderTexture.prototype.update=function(t){if(!(t.delay>0&&!t.delayVisible||!t.visible||0===t.color.alpha.calc)){var e=t.texture.key,r=t.texture.frame;void 0===r&&void 0!==t.texture.frameName&&(r=t.texture.frameName),this.stamp.key!==e?this.stamp.loadTexture(e,r):void 0!==t.texture.frame?this.stamp.frame=r:void 0!==t.texture.frameName&&(this.stamp.frameName=r),this.stamp.anchor.set(t.transform.anchor.x,t.transform.anchor.y),this.stamp.alpha=t.color.alpha.calc,this.stamp.rotation=t.transform.rotation.calc,t.color.isTinted&&(this.stamp.tint=t.color.tint),this.stamp.blendMode=t.color.blendMode[0],this.stamp.texture.baseTexture.scaleMode=t.texture.scaleMode,this.stamp.scale.setTo(t.transform.scale.x.calc,t.transform.scale.y.calc),this.renderTexture.renderXY(this.stamp,t.transform.x,t.transform.y,!1)}},Phaser.ParticleStorm.Renderer.RenderTexture.prototype.destroy=function(){this.display.destroy(),this.stamp.destroy(),this.renderTexture.destroy(),this.emitter=null,this.game=null},Phaser.ParticleStorm.Renderer.SpriteBatch=function(t){Phaser.ParticleStorm.Renderer.Base.call(this,t),this.display=this.game.make.spriteBatch()},Phaser.ParticleStorm.Renderer.SpriteBatch.prototype=Object.create(Phaser.ParticleStorm.Renderer.Base.prototype),Phaser.ParticleStorm.Renderer.SpriteBatch.prototype.constructor=Phaser.ParticleStorm.Renderer.SpriteBatch,Phaser.ParticleStorm.Renderer.SpriteBatch.prototype.add=function(t){var e=t.sprite,r=t.texture.key,i=t.texture.frame;return void 0===i&&void 0!==t.texture.frameName&&(i=t.texture.frameName),e?(e.reset(t.transform.x,t.transform.y),e.key!==r?e.loadTexture(r,i):void 0!==t.texture.frame?e.frame=i:void 0!==t.texture.frameName&&(e.frameName=i)):e=this.game.make.sprite(t.transform.x,t.transform.y,r,i),this.display.addChild(e),e.anchor.set(t.transform.anchor.x,t.transform.anchor.y),t.color.isTinted&&(e.tint=t.color.tint),e.blendMode=t.color.blendMode[0],e.texture.baseTexture.scaleMode=t.texture.scaleMode,e.visible=t.visible,t.sprite=e,e},Phaser.ParticleStorm.Renderer.SpriteBatch.prototype.update=function(t){var e=t.sprite;return t.delay>0&&!t.delayVisible?void(e.visible=!1):(e.visible=t.visible,e.alpha=t.color.alpha.calc,e.rotation=t.transform.rotation.calc,t.color.isTinted&&(e.tint=t.color.tint),e.scale.setTo(t.transform.scale.x.calc,t.transform.scale.y.calc),e.x=t.transform.x,void(e.y=t.transform.y))},Phaser.ParticleStorm.Renderer.SpriteBatch.prototype.kill=function(t){t.sprite&&t.sprite.kill()},Phaser.ParticleStorm.Renderer.SpriteBatch.prototype.destroy=function(){this.display.destroy(!0),this.emitter=null,this.game=null};